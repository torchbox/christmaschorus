<!DOCTYPE HTML>
<html>
	<head>
		<title>Trolololthesizer</title>
		<script src="{{ STATIC_URL }}js/jquery-1.6.2.min.js"></script>
		<script src="{{ STATIC_URL }}js/simplesample.js"></script>
		<script>simplesample.swfPath = "{{ STATIC_URL }}swf/mp3.swf"</script>
		<script src="{{ STATIC_URL }}lib/colorbox/jquery.colorbox.min.js"></script>
		<link rel="stylesheet" href="{{ STATIC_URL }}lib/colorbox/colorbox.css" />
		<link rel="stylesheet" href="{{ STATIC_URL }}css/card.css" />
		<script src="{{ STATIC_URL }}js/json2.js"></script>
		<script src="{{ STATIC_URL }}js/jquery.drag.js"></script>
		<script src="{{ STATIC_URL }}js/chorus.js"></script>
		<script>
			$(function() {
				$.chorus({{ song.notes_json|safe }});
			})
		</script>
	</head>
	<body>
		<h1>
			{{ song.title }}
			<input type="button" id="play" value="Play" />
		</h1>
		
		<ul id="staffs"><li></li></ul>
		<input type="button" id="add_track" value="Add another part" />
		
		{% if song.id %}
			{% with song.score as score %}
				<p>{{ score }} vote{{ score|pluralize }}</p>
				<form action="{% url vote song.code %}" method="POST">
					{% csrf_token %}
					<input type="hidden" name="score" value="1" />
					<input type="submit" value="+" />
				</form>
				<form action="{% url vote song.code %}" method="POST">
					{% csrf_token %}
					<input type="hidden" name="score" value="-1" />
					<input type="submit" value="-" />
				</form>
			{% endwith %}
			
			<a href="https://twitter.com/share" class="twitter-share-button" data-text="The Torchbox trololol chorus presents: {{ song.title }}" data-count="vertical" data-via="torchbox">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
			<!-- TODO: insert domain in facebook share link -->
			<iframe src="https://www.facebook.com/plugins/like.php?href=http://torchbox.com{{ song.get_absolute_url }}"
				scrolling="no" frameborder="0"
				style="border:none; width:450px; height:80px"></iframe>
		{% else %}
			<a href="https://twitter.com/share" class="twitter-share-button" data-text="Torchbox wishes you a musical trololol Christmas!" data-count="vertical" data-via="torchbox">Tweet</a><script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
			<!-- TODO: insert domain in facebook share link -->
			<iframe src="https://www.facebook.com/plugins/like.php?href=http://torchbox.com/"
				scrolling="no" frameborder="0"
				style="border:none; width:450px; height:80px"></iframe>
		{% endif %}
		
		<input type="button" id="share" value="Share" />
		
		<h2>Highest voted songs</h2>
		<ul>
			{% for song in highest_voted_songs %}
				<li>
					<a href="{{ song.get_absolute_url }}">{{ song.title }}</a>
					({{ song.vote_score|default_if_none:0 }} vote{{ song.vote_score|default_if_none:0|pluralize }})
				</li>
			{% endfor %}
		</ul>
		<h2>Latest songs</h2>
		<ul>
			{% for song in latest_songs %}
				<li>
					<a href="{{ song.get_absolute_url }}">{{ song.title }}</a>
					({{ song.vote_score|default_if_none:0 }} vote{{ song.vote_score|default_if_none:0|pluralize }})
				</li>
			{% endfor %}
		</ul>
		
		<div class="popups">
			<div id="save_popup">
				<form action="{% url create_song %}" method="post">
					{% csrf_token %}
					<p>Enter a title for your song:</p>
					
					<table>
						{{ form }}
					</table>
					<input type="submit" value="Share it!" />
			</div>
			<div id="loading_popup"></div>
		</div>
	</body>
</html>
